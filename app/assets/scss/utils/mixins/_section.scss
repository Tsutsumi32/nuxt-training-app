@use 'sass:map';
@use '../variables/variables' as *;
@use '../functions/style-settings' as *;
@use './media' as *;

/******************************************************************
* section　section余白を設定する
* @param $_type 大きさのタイプ（_variables.scssの$section-sizesで定義）
* @param $_margin padding(pd)・margin(mg)
* $media_query_strategy で 'sp-first' または 'pc-first' を切り替え可能
*   - 'sp-first': SPをデフォルト、大きい画面で上書き
*   - 'pc-first': PCをデフォルト、小さい画面で上書き
*
* $section-sizesのキー名は$breakpointsのキー名と統一されています
*******************************************************************/
@mixin section($_type: 'normal', $_margin: 'pd') {
  // $section-sizesから指定されたタイプのサイズを取得
  @if not map.has-key($section-sizes, $_type) {
    @error "section(): 指定されたタイプ '#{$_type}' は $section-sizes に定義されていません。";
  }

  $_sizes: map.get($section-sizes, $_type);

  // デフォルト値を取得（メディアクエリを使用しない時の値）
  $_size-default: map.get($_sizes, 'default');
  @if $_size-default == null {
    @error "section(): '#{$_type}' に 'default' が定義されていません。";
  }

  // SPファーストの場合
  @if $media_query_strategy == 'sp-first' {
    // デフォルト値を設定（メディアクエリなし）
    @if $_margin == 'mg' {
      margin-block: s($_size-default);
    } @else {
      padding-block: s($_size-default);
    }

    // $breakpointsの各キーを順番に処理（小さい方から）
    @each $breakpoint-key in map.keys($breakpoints) {
      $_size-value: map.get($_sizes, $breakpoint-key);
      @if $_size-value != null {
        @include media($breakpoint-key) {
          @if $_margin == 'mg' {
            margin-block: s($_size-value);
          } @else {
            padding-block: s($_size-value);
          }
        }
      }
    }
  } @else {
    // PCファーストの場合
    // デフォルト値を設定（メディアクエリなし）
    @if $_margin == 'mg' {
      margin-block: s($_size-default);
    } @else {
      padding-block: s($_size-default);
    }

    // $breakpointsの各キーを逆順に処理（大きい方から）
    $breakpoint-keys: map.keys($breakpoints);
    @for $i from length($breakpoint-keys) through 1 {
      $breakpoint-key: nth($breakpoint-keys, $i);
      $_size-value: map.get($_sizes, $breakpoint-key);
      @if $_size-value != null {
        @include media($breakpoint-key) {
          @if $_margin == 'mg' {
            margin-block: s($_size-value);
          } @else {
            padding-block: s($_size-value);
          }
        }
      }
    }
  }
}
